<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>RootCore Packages: CP::MakeSystematicsVector Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="../../search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="../../hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../d2/d4c/namespaceCP.html">CP</a>::<a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html">MakeSystematicsVector</a>
  </div>
</div>
<div class="contents">
<h1>CP::MakeSystematicsVector Class Reference</h1><!-- doxytag: class="CP::MakeSystematicsVector" -->
<p>This class handles turning the list of systematics into the actual list of nuisance parameter points to evaluate.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../df/d13/MakeSystematicsVector_8h_source.html">MakeSystematicsVector.h</a>&gt;</code></p>

<p><a href="../../d2/d04/classCP_1_1MakeSystematicsVector-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><b>GroupConfig</b></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the configuration for the given group <br/></td></tr>
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#ad20cad486672432425436f66ef122582">testInvariant</a> () const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">test the invariant of this object  <a href="#ad20cad486672432425436f66ef122582"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a8f4306981c5f7dff7ab97fc720937cfa">MakeSystematicsVector</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">standard default constructor  <a href="#a8f4306981c5f7dff7ab97fc720937cfa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const std::vector<br class="typebreak"/>
&lt; <a class="el" href="../../d4/d52/classCP_1_1SystematicSet.html">SystematicSet</a> &gt; &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a516081c3029846893baf12d81716c2a0">result</a> (const std::string &amp;label) const </td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the list of nuisance parameter points generated with the given label  <a href="#a516081c3029846893baf12d81716c2a0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#aedfa44fe5548334e1754d7144baa6ccb">calc</a> (const <a class="el" href="../../d4/d52/classCP_1_1SystematicSet.html">SystematicSet</a> &amp;sysList)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">fill in <a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a516081c3029846893baf12d81716c2a0">result</a>  <a href="#aedfa44fe5548334e1754d7144baa6ccb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a2df561f02c4534ada178b2b6037ed5d3">addGroup</a> (const std::string &amp;val_label)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">finish configuration for this group and add a new one  <a href="#a2df561f02c4534ada178b2b6037ed5d3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a1852c8c4af767746fa409d5afda9b557">setPattern</a> (const std::string &amp;val_pattern)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set the pattern for the current group  <a href="#a1852c8c4af767746fa409d5afda9b557"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a3f8b0876da36716a7ce69ccd8fcff81a">setSigma</a> (float val_sigma)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set the number of sigmas to vary this group by  <a href="#a3f8b0876da36716a7ce69ccd8fcff81a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a73b9b2300349b599850237fa56413de6">setToys</a> (unsigned val_toys)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set the number of toys to run for this group  <a href="#a73b9b2300349b599850237fa56413de6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a025c090df8fcdb3179ad3ae03c406993">useForNominal</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">set this group as the default, i.e. the group containing the nominal variation  <a href="#a025c090df8fcdb3179ad3ae03c406993"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This class handles turning the list of systematics into the actual list of nuisance parameter points to evaluate. </p>
<p>This is meant as a placeholder for a generic tool to be developed by the statistics forum (or as a prototype for it).</p>
<p>For now I decided to keep it as a single class, but there are other options, e.g. the member MakeSystematicsVector::Config could be made a class that the user configures directly and then passes in. However, for now this approach seems better, as it hides some of the mechanics from the user and gives me more freedom on the backend side. </p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a8f4306981c5f7dff7ab97fc720937cfa"></a><!-- doxytag: member="CP::MakeSystematicsVector::MakeSystematicsVector" ref="a8f4306981c5f7dff7ab97fc720937cfa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CP::MakeSystematicsVector::MakeSystematicsVector </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>standard default constructor </p>
<dl class="user"><dt><b>Guarantee</b></dt><dd>no-fail </dd></dl>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a2df561f02c4534ada178b2b6037ed5d3"></a><!-- doxytag: member="CP::MakeSystematicsVector::addGroup" ref="a2df561f02c4534ada178b2b6037ed5d3" args="(const std::string &amp;val_label)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CP::MakeSystematicsVector::addGroup </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>val_label</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>finish configuration for this group and add a new one </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>val_label</em>&nbsp;</td><td>the label for the new group </td></tr>
  </table>
  </dd>
</dl>
<dl class="user"><dt><b>Guarantee</b></dt><dd>strong </dd></dl>
<dl class="user"><dt><b>Failures</b></dt><dd>out of memory II </dd></dl>

</div>
</div>
<a class="anchor" id="aedfa44fe5548334e1754d7144baa6ccb"></a><!-- doxytag: member="CP::MakeSystematicsVector::calc" ref="aedfa44fe5548334e1754d7144baa6ccb" args="(const SystematicSet &amp;sysList)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CP::MakeSystematicsVector::calc </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d4/d52/classCP_1_1SystematicSet.html">SystematicSet</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>sysList</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>fill in <a class="el" href="../../de/d68/classCP_1_1MakeSystematicsVector.html#a516081c3029846893baf12d81716c2a0">result</a> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sysList</em>&nbsp;</td><td>the list of systematics to use, usually the list of recommended systematics from your <a class="el" href="../../d2/d4c/namespaceCP.html" title="Namespace for generic Combined Performance code.">CP</a> tools, framework or the systematics registry </td></tr>
  </table>
  </dd>
</dl>
<dl class="user"><dt><b>Guarantee</b></dt><dd>strong </dd></dl>
<dl class="user"><dt><b>Failures</b></dt><dd>out of memory II<br/>
 configuration errors </dd></dl>

</div>
</div>
<a class="anchor" id="a516081c3029846893baf12d81716c2a0"></a><!-- doxytag: member="CP::MakeSystematicsVector::result" ref="a516081c3029846893baf12d81716c2a0" args="(const std::string &amp;label) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const std::vector&lt; <a class="el" href="../../d4/d52/classCP_1_1SystematicSet.html">SystematicSet</a> &gt; &amp; CP::MakeSystematicsVector::result </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>label</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>the list of nuisance parameter points generated with the given label </p>
<dl class="user"><dt><b>Guarantee</b></dt><dd>strong </dd></dl>
<dl class="user"><dt><b>Failures</b></dt><dd>unknown label </dd></dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>calculate() has been called </dd></dl>

</div>
</div>
<a class="anchor" id="a1852c8c4af767746fa409d5afda9b557"></a><!-- doxytag: member="CP::MakeSystematicsVector::setPattern" ref="a1852c8c4af767746fa409d5afda9b557" args="(const std::string &amp;val_pattern)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CP::MakeSystematicsVector::setPattern </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&nbsp;</td>
          <td class="paramname"> <em>val_pattern</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>set the pattern for the current group </p>
<dl class="user"><dt><b>Guarantee</b></dt><dd>strong </dd></dl>
<dl class="user"><dt><b>Failures</b></dt><dd>out of memory II </dd></dl>

</div>
</div>
<a class="anchor" id="a3f8b0876da36716a7ce69ccd8fcff81a"></a><!-- doxytag: member="CP::MakeSystematicsVector::setSigma" ref="a3f8b0876da36716a7ce69ccd8fcff81a" args="(float val_sigma)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CP::MakeSystematicsVector::setSigma </td>
          <td>(</td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>val_sigma</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>set the number of sigmas to vary this group by </p>
<p>Normally we are using just +/-1 sigma variations, but if the systematics are very small that can get lost in the statistical jitter. For those cases it is better to do a multi-sigma variation and then scale it back to +/-1 sigma thereby reducing the statistical jitter introduced into the systematic. A traditional scaling factor for these cases is to scale by five sigma.</p>
<p>Please note that if you do this, you normally only want to do this for small systematics for which statistical jitter is an issue. For large systematics there is a legitimate concern that a 5 sigma variation won't be 5 times the size of a 1 sigma variation, introducing a different kind of bias. To that end, if you use this, you should normally put the small systematics into a separate group from your regular systematics (which then also makes it easier for you to know which one to scale down). </p>
<dl class="user"><dt><b>Guarantee</b></dt><dd>no-fail </dd></dl>
<dl class="pre"><dt><b>Precondition:</b></dt><dd>val_sigma &gt; 0 </dd></dl>

</div>
</div>
<a class="anchor" id="a73b9b2300349b599850237fa56413de6"></a><!-- doxytag: member="CP::MakeSystematicsVector::setToys" ref="a73b9b2300349b599850237fa56413de6" args="(unsigned val_toys)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CP::MakeSystematicsVector::setToys </td>
          <td>(</td>
          <td class="paramtype">unsigned&nbsp;</td>
          <td class="paramname"> <em>val_toys</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>set the number of toys to run for this group </p>
<p>This is a specialized mechanism pioneered for the e/gamma and muon scale factors. Instead of evaluating a large number of systematics separately, it allows to vary all of them at the same time repeatedly, so that instead of hundreds of systematic variations you only have to perform maybe 10 or 20 "toy" variations. You then just take the spread of the variations as the overall systematic uncertainty from the toys. There are reports that compared to the "old" method this can yield a factor five reduction in systematic uncertainty without increasing the number of systematic variations to evaluate.</p>
<p>Please note that this approach requires a more expert handling than "regular" systematics. The main point here is that the "toy" variations need a different post-processing than regular variations, i.e. you need to look at the spread between the output histograms for the different "toys" and use that to construct the combined systematic. The e/gamma group currently (Oct 15) provides a tool for that. For Bayesian marginalization you may alternatively consider to integrate the "toy" variations directly into the integral over nuisance parameter space to extract more information than you could with a single systematic.</p>
<p>A general concern for all methods that reduce the number of nuisance parameters (including the "toy" approach) is if you use profiling and are able to constrain the "toy" systematic, in which case we generally assume that such an approach is invalid. Similar precautions should be taken when used with Bayesian marginalization. This is typically of little practical concern as long as the systematic in question is small, but it is something that you should check for and that you should include in your supporting documentation.</p>
<p>The "toy" approach to systematics evaluation introduces an additional statistical jitter into your systematics, due to the sampling fluctuations of your "toy" variations. Naturally this uncertainty decreases if you use a larger number of "toy" variations. We currently (Oct 15) provide no recommendations for evaluating the size of that uncertainty or for determining whether your chosen number of "toys" is sufficient. Anecdotal evidence from the e/gamma group suggests that for evaluating their scale factor systematic as little as 10 or 20 "toys" may be sufficient. However, this will vary depending on your analysis and the systematics you use the "toys" for.</p>
<p>If you decide to go for a large number of "toy" variations it may be better to go for a "traditional" evaluation of your systematics instead, as that can cut down on the aforementioned statistical jitter by interpolating between the variations. The number of variations needed for the traditional approach to be better (or even feasible) will depend on the interpolation algorithm used and is likely to improve as we implement better interpolation algorithms. </p>
<dl class="user"><dt><b>Guarantee</b></dt><dd>no-fail </dd></dl>

</div>
</div>
<a class="anchor" id="ad20cad486672432425436f66ef122582"></a><!-- doxytag: member="CP::MakeSystematicsVector::testInvariant" ref="ad20cad486672432425436f66ef122582" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CP::MakeSystematicsVector::testInvariant </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>test the invariant of this object </p>
<dl class="user"><dt><b>Guarantee</b></dt><dd>no-fail </dd></dl>

</div>
</div>
<a class="anchor" id="a025c090df8fcdb3179ad3ae03c406993"></a><!-- doxytag: member="CP::MakeSystematicsVector::useForNominal" ref="a025c090df8fcdb3179ad3ae03c406993" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CP::MakeSystematicsVector::useForNominal </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>set this group as the default, i.e. the group containing the nominal variation </p>
<dl class="user"><dt><b>Guarantee</b></dt><dd>no-fail </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/cvmfs/atlas.cern.ch/repo/sw/ASG/AnalysisBase/2.4.28/PATInterfaces/PATInterfaces/<a class="el" href="../../df/d13/MakeSystematicsVector_8h_source.html">MakeSystematicsVector.h</a></li>
<li>/cvmfs/atlas.cern.ch/repo/sw/ASG/AnalysisBase/2.4.28/PATInterfaces/Root/MakeSystematicsVector.cxx</li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 15 Apr 2017 for RootCore Packages by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
